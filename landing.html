<!doctype html>
<html lang="ko">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Project Cards</title>

  <style>
    :root {
      --bg: #0b0b0b;
      --fg: rgba(255, 255, 255, .9);
      --muted: rgba(255, 255, 255, .65);
      --card: #121212;
      --stroke: rgba(255, 255, 255, .14);
      --shadow: 0 24px 80px rgba(0, 0, 0, .55);
      --shadow2: 0 12px 40px rgba(0, 0, 0, .45);
      --radius: 22px;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      overflow: hidden;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }

    /* ===== Intro Overlay (p5 text) ===== */
    .intro {
      position: fixed;
      inset: 0;
      z-index: 9999;
      background: radial-gradient(1200px 800px at 50% 35%, rgba(255, 255, 255, .06), transparent 55%),
        #080808;
      display: grid;
      place-items: center;
      opacity: 1;
      transition: opacity 420ms ease;
    }

    .intro.hide {
      opacity: 0;
      pointer-events: none;
    }

    .intro-ui {
      position: absolute;
      bottom: 28px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      user-select: none;
      color: rgba(255, 255, 255, .7);
      font-size: 12px;
      line-height: 1.45;
      padding: 10px 14px;
      border: 1px solid rgba(255, 255, 255, .12);
      border-radius: 999px;
      background: rgba(0, 0, 0, .35);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }

    .intro-ui kbd {
      font: 11px/1.2 ui-monospace, SFMono-Regular, Menlo, monospace;
      background: rgba(255, 255, 255, .08);
      border: 1px solid rgba(255, 255, 255, .14);
      padding: 2px 6px;
      border-radius: 6px;
      margin: 0 3px;
      color: rgba(255, 255, 255, .75);
    }

    #introCanvasHost {
      width: 100vw;
      height: 100vh;
    }

    /* ===== Main UI (cards) ===== */
    .wrap {
      height: 100%;
      display: grid;
      grid-template-rows: auto 1fr auto auto;
      align-items: center;
      justify-items: center;
      padding: 28px 18px;
    }

    .title {
      text-align: center;
      line-height: 1.15;
      user-select: none;
    }

    .title h1 {
      margin: 0;
      font-size: clamp(28px, 4vw, 46px);
      letter-spacing: .4px;
    }

    .title p {
      margin: 10px 0 0;
      font-size: 13px;
      color: var(--muted);
    }

    .stage {
      position: relative;
      width: min(760px, 96vw);
      height: min(520px, 66vh);
      display: grid;
      place-items: center;
      isolation: isolate;
    }

    .deck {
      position: relative;
      width: min(520px, 92vw);
      height: min(360px, 52vh);
    }

    .card {
      position: absolute;
      inset: 0;
      margin: auto;
      width: 100%;
      height: 100%;
      border-radius: var(--radius);
      border: 1px solid var(--stroke);
      background:
        radial-gradient(1200px 520px at 10% 10%, rgba(255, 255, 255, .10), transparent 45%),
        radial-gradient(900px 520px at 90% 20%, rgba(255, 255, 255, .06), transparent 50%),
        var(--card);
      box-shadow: var(--shadow2);
      overflow: hidden;

      display: flex;
      align-items: flex-end;
      justify-content: flex-start;

      padding: 18px 18px 16px;
      cursor: pointer;

      transform: translateZ(0);
      transition:
        transform .45s cubic-bezier(.2, .8, .2, 1),
        filter .35s ease,
        opacity .35s ease,
        box-shadow .45s cubic-bezier(.2, .8, .2, 1);
      will-change: transform;
    }

    .card .card-img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: brightness(.9);
      z-index: 0;
    }

    .card .label {
      display: flex;
      flex-direction: column;
      gap: 4px;
      z-index: 2;
    }

    .card .label .name {
      font-size: 22px;
      font-weight: 700;
      letter-spacing: .3px;
    }

    .card .label .hint {
      font-size: 12px;
      color: rgba(255, 255, 255, .72);
    }

    .card::before {
      content: attr(data-short);
      position: absolute;
      top: 14px;
      left: 14px;
      font-weight: 800;
      letter-spacing: .5px;
      font-size: 14px;
      color: rgba(255, 255, 255, .9);
      padding: 8px 10px;
      border-radius: 14px;
      background: rgba(255, 255, 255, .07);
      border: 1px solid rgba(255, 255, 255, .12);
      z-index: 2;
      user-select: none;
    }

    .card::after {
      content: "";
      position: absolute;
      inset: -40%;
      background: linear-gradient(120deg, transparent 35%, rgba(255, 255, 255, .08) 45%, transparent 55%);
      transform: translateX(-30%) rotate(12deg);
      opacity: .55;
      pointer-events: none;
      z-index: 1;
    }

    .pos-left {
      transform: translateX(-18%) rotate(-8deg) scale(.92);
      opacity: .85;
      filter: brightness(.85);
      z-index: 1;
    }

    .pos-center {
      transform: translateX(0) rotate(0deg) scale(1);
      opacity: 1;
      filter: brightness(1);
      z-index: 3;
      box-shadow: var(--shadow);
    }

    .pos-right {
      transform: translateX(18%) rotate(8deg) scale(.92);
      opacity: .85;
      filter: brightness(.85);
      z-index: 1;
    }

    .card:hover {
      filter: brightness(1.05);
    }

    .pos-left:hover,
    .pos-right:hover {
      filter: brightness(.95);
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 12px;
      user-select: none;
      margin-top: 8px;
    }

    .btn {
      width: 44px;
      height: 44px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, .16);
      background: rgba(255, 255, 255, .06);
      color: rgba(255, 255, 255, .9);
      cursor: pointer;
      display: grid;
      place-items: center;
      box-shadow: 0 12px 30px rgba(0, 0, 0, .35);
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
    }

    .btn:hover {
      background: rgba(255, 255, 255, .10);
      border-color: rgba(255, 255, 255, .22);
    }

    .btn:active {
      transform: scale(.96);
    }

    .btn:focus {
      outline: none;
    }

    .btn:focus-visible {
      outline: 2px solid rgba(255, 255, 255, .28);
      outline-offset: 3px;
    }

    .footer {
      font-size: 12px;
      color: rgba(255, 255, 255, .55);
      text-align: center;
      line-height: 1.45;
      user-select: none;
      margin-top: 10px;
    }

    .footer kbd {
      font: 11px/1.2 ui-monospace, SFMono-Regular, Menlo, monospace;
      background: rgba(255, 255, 255, .08);
      border: 1px solid rgba(255, 255, 255, .14);
      padding: 2px 6px;
      border-radius: 6px;
      margin: 0 3px;
      color: rgba(255, 255, 255, .75);
    }

    @media (max-width:420px) {
      .card .label .name {
        font-size: 18px;
      }

      .deck {
        height: min(320px, 50vh);
      }
    }
  </style>
</head>

<body>

  <!-- ===== Intro Overlay ===== -->
  <div class="intro" id="intro">
    <div id="introCanvasHost" aria-label="intro text canvas"></div>
    <div class="intro-ui">
      마우스를 가까이 대면 글자가 피합니다 · 종료: <kbd>Click</kbd> 또는 <kbd>Enter</kbd>
    </div>
  </div>

  <!-- ===== Main UI ===== -->
  <div class="wrap" id="mainUI" aria-hidden="false">
    <div class="title" aria-live="polite">
      <h1 id="pageTitle">BIO</h1>
      <p>카드를 클릭하면 해당 페이지로 이동합니다.</p>
    </div>

    <div class="stage">
      <div class="deck" id="deck" aria-label="Project navigation cards"></div>
    </div>

    <div class="controls">
      <button class="btn" id="prevBtn" type="button" aria-label="Previous">&#x2039;</button>
      <button class="btn" id="nextBtn" type="button" aria-label="Next">&#x203A;</button>
    </div>

    <div class="footer">
      키보드도 지원: <kbd>←</kbd> <kbd>→</kbd> / 중앙 카드 클릭
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.4/lib/p5.min.js"></script>

  <script>
    /* =========================
       1) Card UI (your code)
    ========================== */
    const projects = [
      { name: "ART_TECH", short: "AT", href: "./art_tech.html" },
      { name: "BIO", short: "BIO", href: "./bio.html" },
      { name: "BIOINFORM", short: "BI", href: "./bioinform.html" },
    ];

    const imageMap = {
      "BIO": "./asset/1.jpg",
      "ART_TECH": "./asset/2.jpg",
      "BIOINFORM": "./asset/3.jpg",
    };

    const deck = document.getElementById("deck");
    const pageTitle = document.getElementById("pageTitle");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    let current = 1; // 시작: BIO(가운데)
    function mod(n, m) { return ((n % m) + m) % m; }

    function renderCards() {
      deck.innerHTML = "";

      const n = projects.length;
      const leftIdx = mod(current - 1, n);
      const centerIdx = mod(current, n);
      const rightIdx = mod(current + 1, n);

      const order = [
        { idx: leftIdx, pos: "pos-left" },
        { idx: centerIdx, pos: "pos-center" },
        { idx: rightIdx, pos: "pos-right" }
      ];

      pageTitle.textContent = projects[centerIdx].name;

      order.forEach(({ idx, pos }) => {
        const p = projects[idx];

        const card = document.createElement("div");
        card.className = `card ${pos}`;
        card.setAttribute("role", "button");
        card.setAttribute("tabindex", pos === "pos-center" ? "0" : "-1");
        card.setAttribute("aria-label", `${p.name} 페이지로 이동`);
        card.dataset.href = p.href;
        card.dataset.short = p.short;

        card.innerHTML = `
          <img class="card-img" src="${imageMap[p.name] || ''}" alt="">
          <div class="label">
            <div class="name">${p.name}</div>
            <div class="hint">Click to open</div>
          </div>
        `;

        card.addEventListener("click", () => {
          window.location.href = p.href;
        });

        card.addEventListener("keydown", (e) => {
          if (pos !== "pos-center") return;
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            window.location.href = p.href;
          }
        });

        deck.appendChild(card);
      });
    }

    function prev() { current = mod(current - 1, projects.length); renderCards(); }
    function next() { current = mod(current + 1, projects.length); renderCards(); }

    prevBtn.addEventListener("click", prev);
    nextBtn.addEventListener("click", next);

    window.addEventListener("keydown", (e) => {
      // 인트로 종료 키는 아래에서 처리
      if (e.key === "ArrowLeft") prev();
      if (e.key === "ArrowRight") next();
    });

    renderCards();


    /* =========================
       2) Intro Text (Vehicle)
       - uses your logic: arrive + flee
    ========================== */

    const introEl = document.getElementById("intro");
    let introDone = false;

    function endIntro() {
      if (introDone) return;
      introDone = true;
      introEl.classList.add("hide");
      // 애니메이션 끝나면 DOM에서 제거해서 클릭/키보드 완전 해방
      setTimeout(() => {
        introEl.style.display = "none";
      }, 460);
    }

    // Enter로 종료
    window.addEventListener("keydown", (e) => {
      if (!introDone && (e.key === "Enter")) endIntro();
    });

    // 클릭으로 종료
    introEl.addEventListener("pointerdown", () => endIntro());

    // ===== Intro Vehicle (soft start, slower, near-target spawn) =====
    function Vehicle(p, x, y, startX, startY) {
      this.p = p;

      // start near the target so points settle in place instead of swarming
      this.pos = p.createVector(startX, startY);
      this.target = p.createVector(x, y);

      this.vel = p.createVector(0, 0);
      this.acc = p.createVector(0, 0);

      this.r = 6;

      // gentler speed/force
      this.maxspeed = 4.2;
      this.maxforce = 0.35;

      // initial snap interpolation to make first settle smoother
      this.snap = 1.0;
      this.snapDecay = 0.06;
    }

    Vehicle.prototype.behaviors = function () {
      var p = this.p;

      var arrive = this.arrive(this.target);
      var mouse = p.createVector(p.mouseX, p.mouseY);
      var flee = this.flee(mouse);

      arrive.mult(1.0);
      flee.mult(1.6);

      this.applyForce(arrive);
      this.applyForce(flee);
    };

    Vehicle.prototype.applyForce = function (f) { this.acc.add(f); };

    Vehicle.prototype.update = function () {
      // softly pull toward target for first few frames
      if (this.snap > 0) {
        const t = this.p.constrain(1 - this.snap, 0, 1);
        this.pos.x = this.p.lerp(this.pos.x, this.target.x, 0.12 + 0.18 * t);
        this.pos.y = this.p.lerp(this.pos.y, this.target.y, 0.12 + 0.18 * t);
        this.snap = Math.max(0, this.snap - this.snapDecay);
      }

      this.vel.add(this.acc);
      this.vel.limit(this.maxspeed);
      this.pos.add(this.vel);
      this.acc.mult(0);
    };

    Vehicle.prototype.show = function () {
      var p = this.p;
      p.stroke(255);
      p.strokeWeight(5);
      p.point(this.pos.x, this.pos.y);
    };

    Vehicle.prototype.arrive = function (target) {
      var p = this.p;
      var desired = p5.Vector.sub(target, this.pos);
      var d = desired.mag();
      var speed = this.maxspeed;

      // larger slow-down radius for gentler stop
      if (d < 160) speed = p.map(d, 0, 160, 0, this.maxspeed);

      desired.setMag(speed);
      var steer = p5.Vector.sub(desired, this.vel);
      steer.limit(this.maxforce);
      return steer;
    };

    Vehicle.prototype.flee = function (target) {
      var p = this.p;
      var desired = p5.Vector.sub(target, this.pos);
      var d = desired.mag();

      // smaller flee radius to reduce jitter
      if (d < 45) {
        desired.setMag(this.maxspeed);
        desired.mult(-1);
        var steer = p5.Vector.sub(desired, this.vel);
        steer.limit(this.maxforce);
        return steer;
      }
      return p.createVector(0, 0);
    };

    // ===== p5 intro sketch (sequential lines, near-target spawn) =====
    const introSketch = (p) => {
      let font;

      // line-split for sequential reveal
      const lines = [
        "Hello, I'm Deaun Lee.",
        "I am majoring in Art & Technology and Life Science at Sogang University.",
        "I aspire to become a specialist in bioinformatics."
      ];

      let lineTargets = [];
      let lineVehicles = [];
      let revealIndex = 0;
      let nextRevealAt = 0;

      const REVEAL_DELAY_MS = 850;
      const SAMPLE_DESKTOP = 0.20;
      const SAMPLE_MOBILE = 0.16;

      p.preload = () => {
        font = p.loadFont("./asset/B612Mono-Bold.ttf", () => { }, () => { font = null; });
      };

      p.setup = () => {
        const host = document.getElementById("introCanvasHost");
        const c = p.createCanvas(p.windowWidth, p.windowHeight);
        c.parent(host);
        p.pixelDensity(1);
        p.background(0);
        p.noFill();
        p.stroke(255);

        buildAllLines();

        // first line appears immediately
        revealIndex = 1;
        nextRevealAt = p.millis() + REVEAL_DELAY_MS;
      };

      p.draw = () => {
        if (introDone) return;

        p.background(0, 85);

        // reveal lines one by one
        if (revealIndex < lines.length && p.millis() >= nextRevealAt) {
          revealIndex++;
          nextRevealAt = p.millis() + REVEAL_DELAY_MS;
        }

        for (let li = 0; li < revealIndex; li++) {
          const arr = lineVehicles[li];
          for (let i = 0; i < arr.length; i++) {
            arr[i].behaviors();
            arr[i].update();
            arr[i].show();
          }
        }
      };

      p.windowResized = () => {
        p.resizeCanvas(p.windowWidth, p.windowHeight);
        buildAllLines();
        revealIndex = 1;
        nextRevealAt = p.millis() + REVEAL_DELAY_MS;
      };

      function buildAllLines() {
        lineTargets = [];
        lineVehicles = [];

        const W = p.width;
        const H = p.height;

        const fontSize = clamp(Math.round(W * 0.05), 26, 56);
        const lineGap = Math.round(fontSize * 0.95);
        const sample = (W < 480) ? SAMPLE_MOBILE : SAMPLE_DESKTOP;

        let boundsList = [];
        let totalH = 0;
        for (let i = 0; i < lines.length; i++) {
          const b = (font && font.textBounds)
            ? font.textBounds(lines[i], 0, 0, fontSize)
            : { x: 0, y: 0, w: p.textWidth(lines[i]) || (lines[i].length * fontSize * 0.6), h: fontSize };
          boundsList.push(b);
          totalH += b.h;
          if (i !== lines.length - 1) totalH += lineGap;
        }

        let yCursor = (H - totalH) / 2;

        for (let i = 0; i < lines.length; i++) {
          const b = boundsList[i];
          const x = (W - b.w) / 2 - b.x;
          const y = yCursor + b.h - b.y;

          let pts = [];
          if (font && font.textToPoints) {
            pts = font.textToPoints(lines[i], x, y, fontSize, {
              sampleFactor: sample,
              simplifyThreshold: 0
            });
          }

          // font load failed
          if (!pts || pts.length === 0) {
            p.clear();
            p.background(0);
            p.fill(255);
            p.noStroke();
            p.textAlign(p.CENTER, p.CENTER);
            p.textSize(18);
            p.text("폰트 로드 실패: ./asset/B612Mono-Bold.ttf 경로를 확인하세요", W / 2, H / 2);
            return;
          }

          lineTargets.push(pts);

          const vehicles = [];
          for (let k = 0; k < pts.length; k++) {
            const t = pts[k];
            const ang = p.random(p.TWO_PI);
            const rad = p.random(18, 48);
            const sx = t.x + Math.cos(ang) * rad;
            const sy = t.y + Math.sin(ang) * rad;

            vehicles.push(new Vehicle(p, t.x, t.y, sx, sy));
          }
          lineVehicles.push(vehicles);

          yCursor += b.h + lineGap;
        }
      }

      function clamp(v, a, b) { return Math.max(a, Math.min(b, v)); }
    };

    // p5 인트로 실행 (instance mode)
    new p5(introSketch);
  </script>

</body>

</html>
